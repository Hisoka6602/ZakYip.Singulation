# ZakYip.Singulation 项目总览

## 本次更新（2025-10-19）

### MAUI 应用横竖屏自适应支持 ✨ 新增
- **响应式布局设计**：所有界面自动适配横屏和竖屏模式
  - 主页面（MainPage）：自动调整控制器列表和操作区域布局
  - 设置页面（SettingsPage）：服务发现列表自适应显示
  - 详情页面（ControllerDetailsPage）：控制按钮和信息卡片响应式布局
- **智能尺寸适配**：根据设备类型（手机、平板、桌面）自动调整控件尺寸
  - 使用 `OnIdiom` 标记为不同设备类型优化显示效果
  - CollectionView 高度根据屏幕大小自动调整
  - 最大宽度限制确保横屏时内容居中显示，提升可读性
- **无缝切换体验**：旋转设备时布局平滑过渡，无需手动刷新
  - Android MainActivity 配置支持 `ConfigChanges.Orientation`
  - 所有页面使用响应式 Grid 布局，自动重排内容
- **跨平台支持**：Android 和 Windows 平台均支持横竖屏切换

### MAUI 应用体验全面提升
- **友好错误提示**：技术错误自动转换为用户友好的提示信息
  - 创建 `ErrorMessageHelper` 智能识别错误类型
  - 应用到所有视图模型的异常处理
- **离线服务缓存**：缓存最近连接的 5 个服务，启动更快
  - 自动加载最近使用的服务
  - 在设置页显示缓存列表，点击即可快速连接
- **网络诊断功能**：智能检测网络状态
  - 检测连接类型（WiFi、移动数据、以太网）
  - 提示服务发现是否可用
  - 不向用户暴露 UDP 技术细节
- **下拉刷新手势**：主页面支持下拉刷新控制器列表
- **SignalR 实时功能完善**：
  - 自动连接：应用启动后 1 秒自动连接
  - 断线重连：指数退避重连策略，最长等待 10 秒（0s → 2s → 10s）
  - 连接状态显示：实时显示连接状态（已连接/连接中/重连中/未连接）
  - 延迟监测：每 5 秒检测连接延迟，实时显示毫秒级延迟
  - 事件订阅：完整订阅轴速度变化、安全事件等实时推送
  - 通知提示：重要事件自动弹出 Toast 通知

详细文档：[MAUI_UX_IMPROVEMENTS.md](docs/MAUI_UX_IMPROVEMENTS.md)

## 之前的更新（2025-10-19）

### MAUI 应用后台管理与 UDP 重试优化
- **禁止后台运行**：Android 应用进入后台时自动结束，防止资源占用和后台运行
  - 修改 `MainActivity.cs`：在 `OnStop()` 中调用 `FinishAndRemoveTask()`
  - 修改 `App.xaml.cs`：添加窗口失活事件处理和日志记录
- **UDP 连接无限重试机制**：连接失败时自动重试，提高连接稳定性
  - 实现 `StartListeningWithRetryAsync` 方法：失败时无限重试，单次最长等待 10 秒
  - 使用指数退避算法：从 200ms 开始，逐步增加到最大 10 秒
  - 连续错误处理：接收循环检测连续 3 次错误后重新初始化 UDP 客户端
  - 详细日志记录：记录每次重试的次数和错误信息
- **XAML 编译优化**：修复 Button.Content 不兼容问题
  - 替换所有 Button.Content 为简单 Text 属性
  - 使用 Emoji 图标（🔄 📤 ✅ ❌ ⚡ 🔗）替代 FontAwesome，简化依赖
  - 保持 UI 功能不变，提升 XAML 编译兼容性

### MAUI 客户端修复与完善（前期更新）
- **修复编译问题**：解决 `MauiVersion` 未定义错误，将 MAUI 版本固化为 8.0.90（.NET 8 对应的稳定版本）
- **简化目标框架**：仅支持 Android 和 Windows 平台，iOS/MacCatalyst 需在 macOS 上构建
- **修复命名空间冲突**：解决项目命名空间与 `Microsoft.Maui.Hosting.MauiApp` 类型冲突问题
- **完善 MVVM 架构**：
  - 新增 `Services/ApiClient.cs` - HTTP API 客户端，提供控制器查询和安全命令发送功能
  - 新增 `Services/SignalRClientFactory.cs` - SignalR 实时连接工厂
  - 新增 `ViewModels/MainViewModel.cs` - 主页面视图模型，实现刷新控制器、发送安全命令、连接 SignalR
  - 新增 `Converters/InvertedBoolConverter.cs` - 布尔值反转转换器
  - 更新 `MainPage.xaml` - 完整的 UI 界面，包含控制器列表、安全命令发送、SignalR 连接
  - 更新 `MauiProgram.cs` - 注册所有服务和依赖注入
- **添加必要依赖**：
  - `Prism.Maui` 9.0.537 - MVVM 框架
  - `Prism.DryIoc.Maui` 9.0.537 - Prism DI 容器
  - `Microsoft.AspNetCore.SignalR.Client` 8.0.11 - SignalR 客户端
  - `Microsoft.Extensions.Http` 8.0.1 - HttpClient 扩展
  - `Newtonsoft.Json` 13.0.3 - JSON 序列化
- **构建测试成功**：
  - Debug 构建成功
  - Release 发布成功，生成 APK 和 AAB 部署包

### 之前的更新
- **移除进程重启器**：弃用 `IApplicationRestarter` 与 `ProcessApplicationRestarter`，改为通过 RESTful 的 `DELETE /api/system/session` 释放进程，由外部部署脚本负责重启
- **统一安全命令接口**：`SafetyController` 整合为单一的 `POST /api/safety/commands` 入口，并扩展 `SafetyCommandRequestDto` 增加命令类型字段
- **优化 Swagger**：默认生成 `v1` 文档、加载 XML 注释并保持 RESTful 术语一致，确保在线文档完整可读
- **新增雷赛单元测试**：为 `LeadshineLtdmcBusAdapter` 添加针对底层 `Safe` 包装器的单元测试，验证异常捕获与错误复位逻辑
- **补充 REST API 文档**：在 `docs/API.md` 中列出默认地址、各主要接口与示例调用方式
- **性能细节优化**：底层雷赛总线 `Safe` 方法引入 `ConfigureAwait(false)`，避免多余的上下文切换

## 项目架构

本项目采用分层架构设计，包含以下核心组件：

- **Core** - 领域核心与抽象契约
- **Drivers** - 设备驱动层（雷赛 LTDMC）
- **Infrastructure** - 基础设施层（LiteDB 持久化）
- **Protocol** - 上游协议解析
- **Transport** - 传输管线与事件泵
- **Host** - ASP.NET Core 宿主（REST + SignalR）
- **MauiApp** - .NET MAUI 跨平台客户端
- **Tests** - 单元测试
- **ConsoleDemo** - 控制台演示

## 项目完成度

### ✅ 已完成
1. **核心控制层**：轴驱动、控制器聚合、事件系统、速度规划 - 完全实现
2. **安全管理**：安全管线、隔离器、帧防护、调试序列 - 完全实现
3. **REST API**：
   - 轴管理（GET/PATCH/POST 批量操作）
   - 安全命令统一入口（POST /api/safety/commands）
   - 系统会话管理（DELETE /api/system/session）
   - 上游通信控制
   - 解码器服务
   - Swagger 在线文档（含 XML 注释）
4. **SignalR 实时推送**：事件 Hub、实时通知器、队列管理 - 完全实现
5. **雷赛驱动**：LTDMC 总线适配、轴驱动、协议映射、Safe 包装器 - 完全实现
6. **持久化**：LiteDB 存储、配置管理、对象映射 - 完全实现
7. **后台服务**：心跳、日志泵、传输事件泵、调试工作器、分拣工作器 - 完全实现
8. **单元测试**：雷赛总线适配器测试、安全管线测试 - 基础覆盖
9. **MAUI 客户端**：✅ 
   - 项目结构完整
   - MVVM 架构实现（Prism + DryIoc）
   - HTTP API 客户端（7 个功能模块服务）
   - UDP 服务自动发现（带重试机制）
   - SignalR 实时连接工厂（自动重连、延迟监测）
   - 完整 UI 界面（控制器列表、安全命令、SignalR 连接）
   - 用户体验增强（错误提示优化、服务缓存、网络诊断、下拉刷新）
   - Android 后台管理（禁止后台运行）
   - 构建和发布成功（APK/AAB）

### 📊 代码统计
- 总项目数：9 个
- 总源文件数：209 个（.cs, .xaml, .csproj）
- 代码行数：约 15,000+ 行

### ⚙️ 技术栈
- **.NET 8.0** - 运行时框架
- **ASP.NET Core** - Web 框架
- **SignalR** - 实时通信
- **.NET MAUI 8.0.90** - 跨平台移动/桌面应用（Android, Windows, iOS, MacCatalyst）
- **Prism** - MVVM 框架和依赖注入
- **LiteDB** - 嵌入式数据库
- **Swagger/OpenAPI** - API 文档
- **雷赛 LTDMC** - 运动控制硬件

## 📈 项目完成度评估与上线准备

### 整体完成度：约 78%

本项目的核心功能已基本完成，包括：
- ✅ **后端服务（90%）**：核心控制逻辑、安全管理、REST API、SignalR 推送、设备驱动全部完成
- ✅ **客户端应用（80%）**：MAUI 应用核心功能完成，包括服务发现、API 对接、完整 UI、用户体验优化
- ⚠️ **测试与质量（40%）**：有基础单元测试，但缺少集成测试和性能测试
- ⚠️ **部署运维（30%）**：缺少容器化、CI/CD、监控告警等生产环境配置
- ✅ **文档完善（90%）**：API 文档、架构设计、部署运维、故障排查等文档完整

### 🚀 距离生产上线还需准备的内容

#### 🔴 必须完成（上线前必需）

1. **生产环境测试（1-2 周）**
   - 集成测试：完整的端到端测试套件
   - 压力测试：并发连接、高频命令发送
   - 稳定性测试：长时间运行测试（7x24 小时）
   - 硬件兼容性测试：真实雷赛设备上的完整测试
   - 网络异常测试：断网、延迟、丢包等场景

2. **安全加固（3-5 天）**
   - 实现用户认证和授权（JWT Token）
   - API 请求频率限制（防止滥用）
   - 安全命令审计日志（记录所有操作）
   - HTTPS 强制启用和证书配置
   - 输入验证和防注入攻击

3. **错误处理与恢复（3-5 天）**
   - 完善异常处理和错误恢复机制
   - 添加断线重连策略（SignalR、UDP）
   - 设备故障自动检测和告警
   - 日志聚合和错误追踪系统
   - 崩溃报告收集（如 Sentry）

4. **部署配置（2-3 天）**
   - Docker 镜像构建和容器化
   - 生产环境配置文件（appsettings.Production.json）
   - 数据库备份和恢复方案
   - 健康检查端点（/health）
   - 启动脚本和守护进程配置

5. **✅ 运维文档（已完成）**
   - ✅ [运维手册](ops/OPERATIONS_MANUAL.md) - 完整的部署、配置、监控、故障排查流程
   - ✅ [配置指南](ops/CONFIGURATION_GUIDE.md) - 详细的参数说明和调优建议
   - ✅ [备份恢复流程](ops/BACKUP_RECOVERY.md) - 数据备份和恢复的详细步骤
   - ✅ [应急响应预案](ops/EMERGENCY_RESPONSE.md) - 各类紧急情况的处理预案
   - ✅ [部署运维手册](docs/DEPLOYMENT.md) - 详细的部署步骤和环境配置
   - ✅ [故障排查手册](docs/TROUBLESHOOTING.md) - 常见问题的诊断和解决方案

#### 🟡 强烈建议（提升稳定性和可维护性）

6. **监控告警（5-7 天）**
   - Prometheus + Grafana 监控大盘
   - 关键指标监控（CPU、内存、连接数、响应时间）
   - 告警规则配置（邮件、短信、企业微信）
   - 日志分析和可视化（ELK 或 Loki）
   - 性能分析工具集成（APM）

7. **CI/CD 流水线（3-5 天）**
   - GitHub Actions 自动构建
   - 自动化测试执行
   - Docker 镜像自动发布
   - 版本管理和发布流程
   - 回滚机制

8. **MAUI 应用完善（5-7 天）**
   - 应用签名和发布配置
   - 崩溃报告和分析
   - 自动更新机制
   - 离线模式支持
   - 用户使用指南

9. **性能优化（3-5 天）**
   - 数据库查询优化
   - 缓存策略（Redis）
   - 异步处理优化
   - 内存泄漏检测和修复
   - 启动时间优化

#### 🟢 可选优化（长期迭代）

10. **功能扩展**
    - 多语言支持（国际化）
    - 深色主题
    - 数据可视化图表
    - 历史数据分析
    - 移动端通知推送

11. **高可用架构**
    - 负载均衡
    - 服务降级和熔断
    - 分布式部署
    - 数据库主从复制
    - 灾备方案

### ⏱️ 预计上线时间表

基于以上分析，建议的上线计划：

| 阶段 | 时间 | 内容 | 完成标准 |
|------|------|------|----------|
| **Alpha 测试** | 第 1-2 周 | 内部测试，修复关键 Bug | 核心功能可用，无崩溃 |
| **Beta 测试** | 第 3-4 周 | 小范围用户测试，收集反馈 | 主要功能稳定，少量已知问题 |
| **RC 版本** | 第 5 周 | 生产环境模拟测试 | 通过压力测试，文档完善 |
| **正式上线** | 第 6 周 | 生产环境部署，全面推广 | 所有必须项完成，监控就绪 |

**保守估计**：6-8 周可正式上线  
**理想情况**：如资源充足，4-6 周可上线  
**最低要求**：完成所有🔴必须项，约 3-4 周

### 📋 上线检查清单

上线前必须完成的检查项：

- [ ] 所有核心功能测试通过
- [ ] 安全漏洞扫描无高危问题
- [ ] 性能测试达标（响应时间 < 500ms）
- [ ] 7x24 小时稳定性测试通过
- [ ] 完整的运维文档和应急预案
- [ ] 监控告警系统就绪
- [ ] 备份恢复流程验证通过
- [ ] 用户培训材料准备完毕
- [ ] 上线回滚方案制定并演练

## 可继续完善的内容

### 功能增强
1. **MAUI 客户端增强**：
   - 补充应用图标和启动屏设计
   - 添加深色主题支持
   - 实现控制器详情页面
   - 添加轴状态实时监控图表
   - 实现安全事件历史记录查看
   - 添加用户偏好设置（API 地址配置）
   - iOS 和 MacCatalyst 平台构建测试（需 macOS 环境）

2. **SignalR 实时联动**：✅ 已完成
   - ✅ 在 MAUI 客户端自动连接 SignalR
   - ✅ 订阅并显示实时速度变化
   - ✅ 订阅并显示安全事件告警
   - ✅ 实现断线重连策略
   - ⏸️ 添加实时日志流显示

3. **测试覆盖率提升**：
   - Axis 控制器单元测试
   - Upstream 管线单元测试
   - Safety Pipeline 边界测试
   - 性能基准测试
   - 集成测试套件

4. **安全与审计**：
   - 安全命令审计日志持久化
   - 操作者信息记录
   - 命令原因追溯
   - 访问控制和认证（JWT）

5. **部署与 DevOps**：
   - Docker 容器化配置
   - CI/CD 管道（GitHub Actions）
   - 离线 NuGet 包缓存
   - 自动化发布脚本
   - 健康检查端点

### 性能优化
1. 雷赛总线批量操作优化
2. 事件聚合和批处理
3. 内存池和对象复用
4. 异步 IO 性能调优

### 文档完善
1. 架构设计文档
2. 部署运维手册
3. 开发者指南
4. API 使用示例集
5. 故障排查手册

## 🎯 接下来可以做的工作和优化方向

### 短期优化（1-2 周内可完成）

#### 1. MAUI 应用体验提升 ⭐⭐⭐⭐⭐ ✅ 已完成
**优先级：极高** | **工作量：2-3 天**

- ⏸️ 应用图标和启动屏：设计专业的应用图标，提升品牌识别度
- ✅ 错误提示优化：友好的错误提示信息，避免技术术语
- ✅ 加载动画：优化加载状态显示，提升用户体验
- ✅ 离线缓存：缓存最近连接的服务信息，启动更快
- ✅ 手势操作：下拉刷新等移动端常用手势

**实际收益**：显著提升了用户体验，减少了用户学习成本

#### 2. UDP 服务发现增强 ⭐⭐⭐⭐ 🔄 部分完成
**优先级：高** | **工作量：1-2 天**

- ⏸️ 二维码配置：Host 端生成配置二维码，MAUI 扫码自动配置
- ✅ 历史记录：记住最近连接的 5 个服务，快速切换
- ✅ 网络诊断：检测网络状态，提示 UDP 广播是否可用
- ⏸️ 多服务管理：支持管理多个控制器，切换连接

**已实现收益**：简化了配置流程，提高了连接成功率

#### 3. SignalR 实时功能完善 ⭐⭐⭐⭐ ✅ 已完成
**优先级：高** | **工作量：2-3 天**

- ✅ **自动连接**：应用启动后自动连接 SignalR
- ✅ **断线重连**：网络恢复时自动重连，带指数退避
- ✅ **连接状态显示**：实时显示连接状态和延迟
- ✅ **事件订阅**：订阅轴速度变化、安全事件等实时推送
- ✅ **通知提示**：重要事件弹出通知

**实际收益**：实现了真正的实时监控，提升了系统响应速度

#### 4. 日志和诊断工具 ⭐⭐⭐
**优先级：中** | **工作量：2 天**

- **日志查看器**：在 MAUI 应用内查看应用日志
- **网络请求记录**：记录所有 API 调用，便于调试
- **性能监控**：显示 API 响应时间、内存使用等
- **导出诊断报告**：一键导出日志和配置信息

**预期收益**：方便故障排查，减少技术支持成本

### 中期优化（2-4 周内可完成）

#### 5. 安全认证体系 ⭐⭐⭐⭐⭐
**优先级：极高（生产必需）** | **工作量：5-7 天**

- **JWT Token 认证**：实现用户登录和 Token 管理
- **角色权限**：管理员、操作员、观察者等角色
- **审计日志**：记录所有安全命令操作
- **会话管理**：超时自动登出，保护系统安全
- **密码策略**：强密码要求，定期修改提醒

**预期收益**：满足生产环境安全要求，可追溯操作记录

#### 6. 数据可视化 ⭐⭐⭐⭐
**优先级：高** | **工作量：5-7 天**

- **实时速度曲线**：显示轴速度变化趋势图
- **历史数据分析**：查看历史运行数据和统计
- **设备健康度**：设备运行时间、错误次数等指标
- **性能仪表盘**：关键指标的可视化展示
- **报表导出**：生成 PDF/Excel 运行报告

**预期收益**：帮助用户了解系统运行状况，发现潜在问题

#### 7. 自动化测试和 CI/CD ⭐⭐⭐⭐⭐
**优先级：极高（质量保证）** | **工作量：7-10 天**

- **单元测试扩展**：提升覆盖率到 70% 以上
- **集成测试套件**：端到端测试关键业务流程
- **性能基准测试**：建立性能基线，防止性能退化
- **GitHub Actions**：自动构建、测试、发布
- **代码质量检查**：SonarQube 代码扫描

**预期收益**：提高代码质量，减少 Bug，加快发布速度

#### 8. 容器化和部署优化 ⭐⭐⭐⭐
**优先级：高（生产必需）** | **工作量：3-5 天**

- **Docker 镜像**：制作精简的生产镜像
- **Docker Compose**：一键部署完整系统
- **环境变量配置**：灵活的配置管理
- **健康检查**：容器健康状态监控
- **日志集中化**：日志输出到 stdout/stderr

**预期收益**：简化部署流程，提高运维效率

### 长期规划（1-3 个月）

#### 9. 分布式架构演进 ⭐⭐⭐
**优先级：中（大规模场景）** | **工作量：3-4 周**

- **微服务拆分**：按业务域拆分服务
- **消息队列**：RabbitMQ/Kafka 解耦服务
- **分布式缓存**：Redis 集群提升性能
- **负载均衡**：多实例部署，提高可用性
- **服务注册发现**：Consul/Nacos 服务治理

**适用场景**：大规模部署，多控制器集群管理

#### 10. 机器学习和智能化 ⭐⭐⭐
**优先级：低（长期愿景）** | **工作量：1-2 个月**

- **异常检测**：基于历史数据自动检测异常
- **预测性维护**：预测设备故障时间
- **智能调优**：自动优化速度参数
- **模式识别**：识别生产模式和瓶颈
- **智能告警**：减少误报，提高告警准确性

**预期收益**：提升系统智能化水平，减少人工干预

### 💡 立即可开始的优化建议

根据当前项目状态，建议优先开展以下工作：

1. **已完成（本周）**：
   - ✅ 完善 MAUI 应用错误提示和用户体验（2 天）
   - ✅ 实现 SignalR 自动连接和断线重连（2 天）
   - ✅ 实现服务缓存和网络诊断（1 天）

2. **下一步可做**：
   - 🎨 设计并实现应用图标和启动屏（1-2 天）
   - 📱 添加二维码扫描配置功能（1-2 天）
   - 📊 添加日志查看和诊断工具（2 天）

3. **下周可做**：
   - 🔐 实现基础的用户认证（JWT）（3 天）
   - 📝 编写集成测试套件（3 天）
   - 🐳 配置 Docker 容器化（2 天）

4. **本月目标**：
   - 完成安全认证体系
   - 搭建 CI/CD 流水线
   - 实现数据可视化基础功能
   - 通过压力测试和稳定性测试

这些优化将大幅提升项目的生产就绪度，预计一个月内可达到上线标准。

## 📚 运维文档

完整的运维文档位于 `ops/` 和 `docs/` 目录，涵盖部署、配置、监控、故障排查等运维工作的全流程。

### 核心运维文档

| 文档 | 位置 | 说明 |
|------|------|------|
| **运维手册** | [ops/OPERATIONS_MANUAL.md](ops/OPERATIONS_MANUAL.md) | 完整的运维指南，涵盖部署、配置、监控、故障排查 |
| **配置指南** | [ops/CONFIGURATION_GUIDE.md](ops/CONFIGURATION_GUIDE.md) | 详细的配置参数说明和性能调优建议 |
| **备份恢复流程** | [ops/BACKUP_RECOVERY.md](ops/BACKUP_RECOVERY.md) | 数据备份策略、自动化脚本和恢复流程 |
| **应急响应预案** | [ops/EMERGENCY_RESPONSE.md](ops/EMERGENCY_RESPONSE.md) | 各类紧急情况的标准处理流程和预案 |
| **部署运维手册** | [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md) | 详细的部署步骤、环境要求和升级流程 |
| **故障排查手册** | [docs/TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md) | 常见问题的诊断方法和解决方案 |

### 技术文档

| 文档 | 位置 | 说明 |
|------|------|------|
| **架构设计** | [docs/ARCHITECTURE.md](docs/ARCHITECTURE.md) | 系统架构和设计文档 |
| **API 文档** | [docs/API.md](docs/API.md) | REST API 接口文档和使用示例 |
| **MAUI 应用** | [docs/MAUIAPP.md](docs/MAUIAPP.md) | MAUI 客户端功能和使用说明 |
| **性能优化** | [docs/PERFORMANCE.md](docs/PERFORMANCE.md) | 性能优化建议和最佳实践 |
| **开发指南** | [docs/DEVELOPER_GUIDE.md](docs/DEVELOPER_GUIDE.md) | 开发者快速入门和代码规范 |

### 运维快速入口

**部署上线**：
1. 阅读 [运维手册 - 部署章节](ops/OPERATIONS_MANUAL.md#1-部署手册)
2. 执行 [部署运维手册](docs/DEPLOYMENT.md) 中的部署流程
3. 参考 [配置指南](ops/CONFIGURATION_GUIDE.md) 进行生产环境配置

**日常运维**：
1. 查看 [运维手册 - 日常运维章节](ops/OPERATIONS_MANUAL.md#3-日常运维)
2. 配置 [备份恢复流程](ops/BACKUP_RECOVERY.md#4-自动化备份)
3. 设置监控告警（参见运维手册）

**故障处理**：
1. 参考 [故障排查手册](docs/TROUBLESHOOTING.md) 快速诊断
2. 按照 [应急响应预案](ops/EMERGENCY_RESPONSE.md) 处理紧急情况
3. 从 [备份恢复](ops/BACKUP_RECOVERY.md#5-数据恢复) 恢复数据（如需要）

---

## 构建与运行

### 前置要求
- .NET 8.0 SDK
- Visual Studio 2022 或 VS Code
- MAUI 工作负载（用于构建移动应用）
- 雷赛 LTDMC 驱动（用于硬件控制）

### 构建整个解决方案
```bash
# 恢复依赖
dotnet restore

# 构建所有项目
dotnet build

# 运行测试
dotnet test
```

### 运行 Host 服务
```bash
cd ZakYip.Singulation.Host
dotnet run
```
服务将在 http://localhost:5000 启动，Swagger 文档位于 http://localhost:5000/swagger

### 构建 MAUI 应用

#### Android
```bash
cd ZakYip.Singulation.MauiApp

# 构建 Debug 版本
dotnet build -f net8.0-android

# 发布 Release 版本（默认生成 APK 和 AAB）
dotnet publish -f net8.0-android -c Release

# 仅生成 APK
dotnet publish -f net8.0-android -c Release -p:AndroidPackageFormat=apk

# 仅生成 AAB（推荐用于 Google Play）
dotnet publish -f net8.0-android -c Release -p:AndroidPackageFormat=aab
```
输出文件：`bin/Release/net8.0-android/publish/*.apk` 和/或 `*.aab`

#### Windows（需在 Windows 上）
```bash
cd ZakYip.Singulation.MauiApp
dotnet build -f net8.0-windows10.0.19041.0
```

#### iOS/MacCatalyst（需在 macOS 上）
```bash
cd ZakYip.Singulation.MauiApp

# 1. 编辑 ZakYip.Singulation.MauiApp.csproj
# 2. 在 <PropertyGroup> 部分，将第 5 行修改为：
#    <TargetFrameworks Condition="$([MSBuild]::IsOSPlatform('osx'))">net8.0-android;net8.0-ios;net8.0-maccatalyst</TargetFrameworks>

# 3. 构建 iOS 和 MacCatalyst
dotnet build -f net8.0-ios
dotnet build -f net8.0-maccatalyst
```

## 许可证
（待定）

## 贡献指南

欢迎提交问题和拉取请求！在贡献代码时，请遵循以下准则：

### 文档要求
1. **所有 Markdown 文档必须使用中文编写**
   - 所有新增的 `.md` 文件必须使用中文
   - 现有文档如发现英文内容，请翻译为中文

2. **代码变更必须同步更新文档**
   - 添加新功能时，必须在相关文档中说明
   - 修改现有功能时，必须更新对应的文档说明
   - 需要更新的文档包括但不限于：
     - `README.md` - 项目总览和最新更新
     - `docs/API.md` - API 接口变更
     - `docs/MAUIAPP.md` - MAUI 应用功能变更
     - 相关模块的技术文档

3. **提交规范**
   - 提交信息请使用中文
   - 每次提交应包含代码变更和对应的文档更新
   - 在 Pull Request 中明确说明文档的更新内容

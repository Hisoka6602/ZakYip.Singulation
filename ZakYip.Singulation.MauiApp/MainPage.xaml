<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:ZakYip.Singulation.MauiApp.ViewModels"
             xmlns:services="clr-namespace:ZakYip.Singulation.MauiApp.Services"
             x:Class="ZakYip.Singulation.MauiApp.MainPage"
             x:DataType="viewmodels:MainViewModel"
             Title="ZakYip Singulation Control">

    <ScrollView>
        <VerticalStackLayout
            Padding="20"
            Spacing="15">

            <!-- 标题 -->
            <Label
                Text="ZakYip.Singulation MAUI Client"
                Style="{StaticResource Headline}"
                HorizontalTextAlignment="Center"
                SemanticProperties.HeadingLevel="Level1" />

            <!-- 状态信息 -->
            <Frame BorderColor="LightGray" Padding="10">
                <Label
                    Text="{Binding StatusMessage}"
                    HorizontalTextAlignment="Center"
                    FontAttributes="Bold" />
            </Frame>

            <!-- 加载指示器 -->
            <ActivityIndicator 
                IsRunning="{Binding IsLoading}"
                IsVisible="{Binding IsLoading}"
                Color="Blue" />

            <!-- 控制器管理区域 -->
            <Label
                Text="Controllers"
                Style="{StaticResource SubHeadline}"
                Margin="0,10,0,0" />

            <Button
                Text="Refresh Controllers"
                Command="{Binding RefreshControllersCommand}"
                IsEnabled="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"
                HorizontalOptions="Fill" />

            <CollectionView 
                ItemsSource="{Binding Controllers}"
                SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="services:ControllerInfo">
                        <Frame Margin="0,5" Padding="10" BorderColor="LightGray">
                            <VerticalStackLayout Spacing="5">
                                <Label Text="{Binding Name}" FontAttributes="Bold" />
                                <Label Text="{Binding AxisId, StringFormat='Axis ID: {0}'}" FontSize="12" />
                                <Label Text="{Binding StatusText, StringFormat='Status: {0}'}" FontSize="12" />
                                <Label Text="{Binding Enabled, StringFormat='Enabled: {0}'}" FontSize="12" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- 安全命令区域 -->
            <Label
                Text="Safety Commands"
                Style="{StaticResource SubHeadline}"
                Margin="0,20,0,0" />

            <Picker
                Title="Command Type"
                SelectedItem="{Binding SafetyCommandType}">
                <Picker.ItemsSource>
                    <x:Array Type="{x:Type x:String}">
                        <x:String>Start</x:String>
                        <x:String>Stop</x:String>
                        <x:String>Reset</x:String>
                    </x:Array>
                </Picker.ItemsSource>
            </Picker>

            <Entry
                Placeholder="Reason for command"
                Text="{Binding SafetyReason}" />

            <Button
                Text="Send Safety Command"
                Command="{Binding SendSafetyCommandCommand}"
                IsEnabled="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"
                BackgroundColor="Orange"
                HorizontalOptions="Fill" />

            <!-- SignalR连接区域 -->
            <Label
                Text="Real-time Connection"
                Style="{StaticResource SubHeadline}"
                Margin="0,20,0,0" />

            <Button
                Text="Connect to SignalR"
                Command="{Binding ConnectSignalRCommand}"
                IsEnabled="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"
                BackgroundColor="Green"
                HorizontalOptions="Fill" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

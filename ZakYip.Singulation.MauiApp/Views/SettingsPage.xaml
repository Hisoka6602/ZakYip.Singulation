<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:ZakYip.Singulation.MauiApp.ViewModels"
             xmlns:services="clr-namespace:ZakYip.Singulation.MauiApp.Services"
             x:Class="ZakYip.Singulation.MauiApp.Views.SettingsPage"
             x:DataType="viewmodels:SettingsViewModel"
             Title="è®¾ç½®">

    <ScrollView>
        <VerticalStackLayout
            Padding="20"
            Spacing="15">

            <!-- æ ‡é¢˜ -->
            <Label
                Text="âš™ï¸ åº”ç”¨è®¾ç½®"
                Style="{StaticResource Headline}"
                HorizontalTextAlignment="Center"
                SemanticProperties.HeadingLevel="Level1" />

            <!-- UDP æœåŠ¡å‘çŽ° -->
            <Frame BorderColor="LightGray" Padding="15" BackgroundColor="#F5F5F5">
                <VerticalStackLayout Spacing="10">
                    <Label
                        Text="ðŸ” è‡ªåŠ¨å‘çŽ°æœåŠ¡"
                        FontAttributes="Bold"
                        FontSize="18" />

                    <Label
                        Text="é€šè¿‡ UDP å¹¿æ’­è‡ªåŠ¨å‘çŽ°ç½‘ç»œä¸­çš„ Singulation æœåŠ¡"
                        FontSize="12"
                        TextColor="Gray" />

                    <Button
                        Text="{Binding IsDiscovering, Converter={StaticResource BoolToTextConverter}, ConverterParameter='åœæ­¢å‘çŽ°:å¼€å§‹å‘çŽ°'}"
                        Command="{Binding ToggleDiscoveryCommand}"
                        BackgroundColor="{Binding IsDiscovering, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Red:Blue'}"
                        HorizontalOptions="Fill" />

                    <!-- å‘çŽ°çš„æœåŠ¡åˆ—è¡¨ -->
                    <CollectionView
                        ItemsSource="{Binding DiscoveredServices}"
                        SelectionMode="Single"
                        SelectedItem="{Binding SelectedService}"
                        HeightRequest="200"
                        Margin="0,10,0,0">
                        <CollectionView.EmptyView>
                            <Label
                                Text="ðŸ“¡ æ²¡æœ‰å‘çŽ°ä»»ä½•æœåŠ¡\n\nè¯·ç¡®ä¿ï¼š\n1. è®¾å¤‡è¿žæŽ¥åˆ°åŒä¸€ç½‘ç»œ\n2. ä¸»æœåŠ¡å·²å¯åŠ¨\n3. é˜²ç«å¢™å…è®¸ UDP ç«¯å£ 18888"
                                HorizontalTextAlignment="Center"
                                TextColor="Gray"
                                Margin="10" />
                        </CollectionView.EmptyView>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="services:DiscoveredService">
                                <Frame
                                    Padding="10"
                                    Margin="0,5"
                                    BorderColor="LightBlue"
                                    BackgroundColor="White">
                                    <Grid RowDefinitions="Auto,Auto">
                                        <Label
                                            Grid.Row="0"
                                            Text="{Binding DisplayName}"
                                            FontAttributes="Bold"
                                            FontSize="16" />
                                        <Label
                                            Grid.Row="1"
                                            Text="{Binding DisplayInfo}"
                                            FontSize="12"
                                            TextColor="Gray" />
                                    </Grid>
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=ConnectToServiceCommand}"
                                            CommandParameter="{Binding .}" />
                                    </Frame.GestureRecognizers>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- API é…ç½® -->
            <Frame BorderColor="LightGray" Padding="15" BackgroundColor="#F5F5F5">
                <VerticalStackLayout Spacing="10">
                    <Label
                        Text="ðŸ”— API é…ç½®"
                        FontAttributes="Bold"
                        FontSize="18" />

                    <Label Text="API åŸºç¡€åœ°å€" FontSize="14" />
                    <Entry
                        Text="{Binding ApiBaseUrl}"
                        Placeholder="http://localhost:5005"
                        Keyboard="Url" />

                    <Label Text="è¿žæŽ¥è¶…æ—¶ (ç§’)" FontSize="14" />
                    <Entry
                        Text="{Binding TimeoutSeconds}"
                        Placeholder="30"
                        Keyboard="Numeric" />

                    <Button
                        Text="ðŸ’¾ ä¿å­˜è®¾ç½®"
                        Command="{Binding SaveSettingsCommand}"
                        BackgroundColor="Green"
                        HorizontalOptions="Fill"
                        Margin="0,10,0,0" />

                    <Label
                        Text="{Binding StatusMessage}"
                        FontSize="12"
                        HorizontalTextAlignment="Center"
                        Margin="0,5,0,0" />
                </VerticalStackLayout>
            </Frame>

            <!-- åº”ç”¨ä¿¡æ¯ -->
            <Frame BorderColor="LightGray" Padding="15" BackgroundColor="#F5F5F5">
                <VerticalStackLayout Spacing="5">
                    <Label
                        Text="â„¹ï¸ åº”ç”¨ä¿¡æ¯"
                        FontAttributes="Bold"
                        FontSize="18" />

                    <Label Text="ç‰ˆæœ¬: 1.0.0" FontSize="14" />
                    <Label Text="å¹³å°: .NET MAUI 8.0" FontSize="14" />
                    <Label Text="é¡¹ç›®: ZakYip.Singulation" FontSize="14" />
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
